<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>mood</title>
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Saira:wght@200;400&display=swap" rel="stylesheet">
    
        <style>
            :root {
                --bg-color: #1a1a1a;
                --primary-color: #2c3e50;
                --secondary-color: #34495e;
                --accent-color: #008080;
                --text-color: #ecf0f1;
                --shadow-color: rgba(0, 0, 0, 0.5);
            }
    
            body {
                /* CHANGED: Font family, weight, and text transform */
                font-family: 'Saira', sans-serif;
                font-weight: 200;
                text-transform: uppercase;
                
                background-color: var(--bg-color);
                color: var(--text-color);
                margin: 0;
                padding: 2rem;
                text-align: center;
            }
    
            h1 {
                color: var(--accent-color);
                font-weight: 200; /* Lighter weight for consistency */
                letter-spacing: 4px; /* Increased spacing for uppercase */
            }
    
            #soundboard {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1.5rem; /* Slightly increased gap */
                max-width: 1200px;
                margin: 2rem auto;
            }
    
            .track-button {
                background-color: var(--primary-color);
                border: 2px solid var(--secondary-color);
                color: var(--text-color);
                padding: 1.5rem 1rem;
                cursor: pointer;
                
                /* CHANGED: Much rounder corners */
                border-radius: 50px; 
                
                font-size: 1rem;
                font-weight: 200; /* Bolder font for button text */
                text-transform: uppercase;
                letter-spacing: 1px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 8px var(--shadow-color);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
    
            .track-button:hover:not(:disabled) {
                background-color: var(--secondary-color);
                transform: translateY(-5px);
                box-shadow: 0 6px 12px var(--shadow-color);
            }
    
            .track-button.active {
                background-color: var(--accent-color);
                color: var(--bg-color);
                font-weight: 200;
                box-shadow: 0 0 25px var(--accent-color);
                border-color: var(--accent-color);
            }
            
            /* CHANGED: New style for the disabled (transitioning) state */
            .track-button:disabled {
                cursor: not-allowed;
                background-color: transparent; /* Transparent background */
                border: 2px dashed var(--accent-color); /* Dashed accent-color border */
                color: var(--accent-color); /* Text color matches the border */
                opacity: 0.7;
                transform: none;
                box-shadow: none;
            }
        </style>
    </head>
<body>

    <h1>mood</h1>
    <div id="soundboard">
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const soundboard = document.getElementById('soundboard');
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const activeTracks = {};
        
                const repoOwner = 'haamukahvi';
                const repoName = 'mood';
                const tracksPath = 'tracks';
                const FADE_DURATION = 4; // Fade time in seconds
                const MIN_VOLUME = 0.0001; // A tiny value, effectively silent
        
                async function getTrackList() {
                    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${tracksPath}`;
                    try {
                        const response = await fetch(apiUrl);
                        const data = await response.json();
                        return data
                            .filter(file => file.type === 'file' && /\.(mp3|ogg|wav)$/i.test(file.name))
                            .map(file => file.download_url);
                    } catch (error) {
                        console.error('Error fetching track list:', error);
                        soundboard.innerHTML = '<p style="color: #e74c3c;">Failed to load tracks from GitHub. Please check the repository path and make sure it\'s public.</p>';
                        return [];
                    }
                }
        
                function createTrackButton(url) {
                    const fileName = decodeURIComponent(url.split('/').pop().replace(/\.\w+$/, ''));
                    const button = document.createElement('button');
                    button.className = 'track-button';
                    button.textContent = fileName.replace(/_/g, ' ');
                    button.dataset.url = url;
        
                    button.addEventListener('click', () => {
                        if (audioContext.state === 'suspended') {
                            audioContext.resume();
                        }
        
                        if (activeTracks[url]) {
                            stopTrack(url);
                        } else {
                            playTrack(url, button);
                        }
                    });
        
                    soundboard.appendChild(button);
                }
        
                async function playTrack(url, button) {
                    button.disabled = true;
        
                    const audio = new Audio(url);
                    audio.crossOrigin = "anonymous";
                    audio.loop = true;
        
                    const source = audioContext.createMediaElementSource(audio);
                    const gainNode = audioContext.createGain();
                    
                    // --- CHANGED: Set starting volume to the minimum for exponential ramp ---
                    gainNode.gain.setValueAtTime(MIN_VOLUME, audioContext.currentTime);
        
                    source.connect(gainNode);
                    gainNode.connect(audioContext.destination);
        
                    try {
                        await audio.play();
                        
                        // --- CHANGED: Use exponentialRamp for a natural-sounding fade-in ---
                        gainNode.gain.exponentialRampToValueAtTime(1, audioContext.currentTime + FADE_DURATION);
        
                        activeTracks[url] = { audio, source, gainNode, button };
                        button.classList.add('active');
        
                        setTimeout(() => {
                            if (activeTracks[url]) {
                                button.disabled = false;
                            }
                        }, FADE_DURATION * 1000);
        
                    } catch (err) {
                        console.error("Playback failed:", err);
                        button.disabled = false; 
                    }
                }
        
                function stopTrack(url) {
                    const track = activeTracks[url];
                    if (!track) return;
        
                    track.button.disabled = true;
                    track.button.classList.remove('active');
        
                    // --- CHANGED: Use exponentialRamp for a natural-sounding fade-out ---
                    track.gainNode.gain.exponentialRampToValueAtTime(MIN_VOLUME, audioContext.currentTime + FADE_DURATION);
                    
                    setTimeout(() => {
                        track.audio.pause();
                        track.source.disconnect();
                        
                        delete activeTracks[url];
                        
                        track.button.disabled = false; 
                    }, FADE_DURATION * 1000);
                }
        
                async function init() {
                    const trackUrls = await getTrackList();
                    if (trackUrls.length > 0) {
                        trackUrls.forEach(createTrackButton);
                    } else if (!soundboard.innerHTML) {
                         soundboard.innerHTML = '<p>No audio tracks found in the specified folder.</p>';
                    }
                }
        
                init();
            });
        </script>

</body>
</html>